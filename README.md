# Задание 1

## Лист изменений

1. Исправлен адрес бэка, тк изначально фронт смотрел на удаленный сервис
1. Методы для регистрации и авторизации можно вызывать из анонимной зоны, изначально не было возможным вызвать эти методы, тк они были закрыты авторизацией
1. Настроены cors политики, тк без этого все вызовы бэка падали
1. Исправлены урлы на фронте, тк они не соответствовали апи бэка
1. Удалена отправка токена в заголовке, тк бэк смотрит только куки. По какой-то причине на фронте не удавалось прочитать куки, хотя бэк их оптравлял, поэтому временно добавил костыль с отправкой токена в заголовке. Как я понял, проблема в некорректной настройке cors, но до конца разобраться, к сожалению, не удалось
1. В монолите не отображется пользоватеслькая информация, аватарка, и не работает добавление карточек
1. Монолит разбит на микрофронтенды и восстановлена часть функциональностей - работат авторизация и регистрация, отображение\редактирование пользовательской информации, добавление карточек

## Запуск

docker compose up

монолит доступен по http://localhost:3000

микрофронты:

host - http://localhost:8080

auth - http://localhost:8081

profile - http://localhost:8082

plcaes - http://localhost:8083

## Описание системы

Система представляет из себя монолитное приложение со следующими функциями:
1. Авторизация\регистрация пользователя
1. Отображение пользователськой информации
1. Отображение карточек пользователя, где карточка представляет из себя текст, каритнку и лайки
1. Вомзонжность редактирования пользовательской информации
1. Возможность управления пользоватеслькими карточками - удаление, добавление, лайки

Данную систему сложно и дорого поддерживать, так как:
1. она содержит в себе довольно много функциональности, а ее сложность постоянно растет 
1. трудно поддерживать и релизиться нескольким командам
1. компоненты становятся тесно связанными
1. трудно масштабировать отдельные компоненты
1. долгие релизы
1. низкая отказоустойчивость

Кроме того система уже содержит баги.

В связи с вышесказанным, было решено разбить монолит на микрофронтенды. Анализ кода позволяет выделить 3 основных домена приложения: авторизация и регистарция пользователя, профиль пользователя и работа с карточками. Кроме того это соответсвует разделению бэкенда.

**Общая схема:**

    **authentication**

        - Login

        - Register

    **profile**

        - EditAvatarPopup

        - EditProfilePopup

        - Profile

    **card**

        - AddPlacePopup

        - Places

    **host**

        - Footer

        - Header

        - ImagePopup

        - InfoTooltip

        - Main

### authentication

Модуль предоставляет необходимую функциональность для регистрации и авторизации пользователя.

**Интеграции:**

    - микросервис авторизации (signin && signup)

**Компоненты:**

    - Login - компонент для авторизации пользователя

    - Register - компонент для регистрации пользователя

**События:**

    - onUserLogin - после успешной авторизации пользователя. Детали содержат пользовательскую информацию

    - onUserLoginFailed - неудачная попытка авторизации

    - onUserRegister - после успешной регистрации пользователя

    - onUserRegisterFailed - после неудачной попытки регистрации

### card

Модуль предоставляет необходимую функциональность для работы с карточками - отображение, добавление, удаление, лайки. 

**Интеграции:**

    - микросервис карточек (cards && cards/{id} && cards/like/{id})

**События:**

    - onCardAdded - событие о создании новой карточки

    - onCardAddFailed - неуспешное создание карточки

    - onCardClick - клик по карточке

    - onLikeCardStatusChange - лайк по карточке

    - onLikeCardStatusChangeFailed -  неуспешный лайк

    - onCardDelete - удаление карточки

    - onCardDeleteFailed - неуспешное удаление карточки

**Прослушиваемые события:**

    onUserLogin\onUserUpdated - для инициализации карточек пользователя

    onCardAdded - для обновление списка карточек

    onCardAdd - для открытия окна добавления карточки

### profile

Модуль предоставляет необходимую функциональность для работы с пользоватеслькой информации - отображение, редактирование.

**Интеграции:**

    - сервис профилей (users/me && users/me/avatar)

**События:**

    - onAvatarUpdated - обновлдение аватара

    - onAvatarUpdateFailed - неуспешное обновлдение аватара

    - onUserUpdated - изменение пользьзователя

    - onUserUpdateFailed - неуспешное изменение пользьзователя

    - onCardAdd - для открытия окна добавления карточки

**Прослушиваемые события:**

    onUserLogin\onUserUpdated - для инициализации карточек пользователя
    
    onUserUpdate - для отрктия окна редактирования пользователя

    onAvatarUpdate - для открытия окна редактирования аватара

### host

Модуль не взаимодейтсвует с бэком и фактически не содержит никакой логики, а лишь собирает различные компоненты в единое целое.

### Компановка микрофронтендов

В данном случае нам важно сделать приложение отказоустойчивым и быстро обновлять отдельные его части, поэтому нам больше подходит Runtime компановка.

Самыми популярными инструментами для Runtime компановки являются wpmf и single spa. Принцип работы интсурментов сильно схожий, поэтому будем исходить из того, что:
1. нет ограничений в политике компании
1. есть опыт работы с wpmf из прошлого занятия
1. нет необходимости использовать разные фреймворки

Исходя из вышесказанного, решено использовать wpmf.


### Вывод

Таким образом, каждое выделенный компонент представляет из себя автономное приложение, которое предоставляет весь необходимый функционал для работы со своим доменом (отображение, редактирование и тд) и взаимодействует только со своим бэком. Host, в свою очередь, представляет из себя тонкое приложение, которое не содержит никакой логики и интеграций, а лишь собирает отдельные компоненты в единое целое. Межфронтовое взаимодействие осуществляется через события.

Плюсы:
1. Такие приложения легко поддерживать, так как добавление новой фичи затрагивает только один компонент. Например, если мы меняем профиль пользователя, добавляя новые данные, то здесь же меняем и окно для его редактирования.
1. Уменьшается зона ответсвенности команд
1. Ускоряется и упрощается поставка
1. Точечное масштабирование
1. Отказоустойчивость отдельных компонентов
1. Гибкость разработки
1. Низкая связанность

Минусы:
1. Сложность дебага и локализации ошибок
1. Сложность управления состоянием - нужно синхронизировать состояние разлинчных компонентов, учитывать, что какой-то компонент мог не получить\не обработать событие (например, событие возникло до загрузки компонента).
1. Уменьшение производительности
1. Код тяжелее воспринимается

Оставшиеся проблемы:
1. Не работает часть функционала - лайки, и тд, тк нужно добавить обработки\публикации разлинчных событий, а где-то просто поправить наименования событий
1. Местами не учтено то, что публикация события происходит до загрузки компонента, поэтому компонент не получает событие. Нужно наладить взаимодействие через события, унифицировать их, вомзожно, добавить ретраи или ответные события об обработке. Кажется, использование CustomEvent слишком сложно для всего этого
1. Проблемы с неймингом событий (слишком разнородные) и домена (где-то card, где-то places)
1. Перезагрузка страницы сбрасывает все состояния - видимо, нужно сохранить состояния каждого компонента в какой-нибудь localStorage и затем его восстанавливать


# Задание 2

[файл со схемой](./task2.drawio)